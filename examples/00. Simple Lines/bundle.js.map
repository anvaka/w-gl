{"version":3,"file":"bundle.js","sources":["../../node_modules/ngraph.events/index.js","../../node_modules/gl-matrix/esm/common.js","../../node_modules/gl-matrix/esm/mat4.js","../../node_modules/gl-matrix/esm/vec4.js","../../src/Element.js","../../src/clap.js","../../node_modules/wheel/index.js","../../node_modules/bezier-easing/src/index.js","../../node_modules/amator/index.js","../../node_modules/panzoom/lib/kinetic.js","../../node_modules/panzoom/lib/createTextSelectionInterceptor.js","../../node_modules/panzoom/lib/transform.js","../../node_modules/panzoom/lib/svgController.js","../../node_modules/panzoom/lib/domController.js","../../node_modules/panzoom/index.js","../../src/createMapCamera.js","../../src/glUtils.js","../../src/shaderGraph/index.js","../../src/Color.js","../../src/shaderGraph/panzoom.js","../../src/lines/makeLinesProgram.js","../../src/lines/makeWireProgram.js","../../src/lines/createMultiKeyCache.js","../../src/lines/WireAccessor.js","index.js","../../src/createScene.js","../../src/lines/WireCollection.js"],"sourcesContent":["module.exports = function eventify(subject) {\n  validateSubject(subject);\n\n  var eventsStorage = createEventsStorage(subject);\n  subject.on = eventsStorage.on;\n  subject.off = eventsStorage.off;\n  subject.fire = eventsStorage.fire;\n  return subject;\n};\n\nfunction createEventsStorage(subject) {\n  // Store all event listeners to this hash. Key is event name, value is array\n  // of callback records.\n  //\n  // A callback record consists of callback function and its optional context:\n  // { 'eventName' => [{callback: function, ctx: object}] }\n  var registeredEvents = Object.create(null);\n\n  return {\n    on: function (eventName, callback, ctx) {\n      if (typeof callback !== 'function') {\n        throw new Error('callback is expected to be a function');\n      }\n      var handlers = registeredEvents[eventName];\n      if (!handlers) {\n        handlers = registeredEvents[eventName] = [];\n      }\n      handlers.push({callback: callback, ctx: ctx});\n\n      return subject;\n    },\n\n    off: function (eventName, callback) {\n      var wantToRemoveAll = (typeof eventName === 'undefined');\n      if (wantToRemoveAll) {\n        // Killing old events storage should be enough in this case:\n        registeredEvents = Object.create(null);\n        return subject;\n      }\n\n      if (registeredEvents[eventName]) {\n        var deleteAllCallbacksForEvent = (typeof callback !== 'function');\n        if (deleteAllCallbacksForEvent) {\n          delete registeredEvents[eventName];\n        } else {\n          var callbacks = registeredEvents[eventName];\n          for (var i = 0; i < callbacks.length; ++i) {\n            if (callbacks[i].callback === callback) {\n              callbacks.splice(i, 1);\n            }\n          }\n        }\n      }\n\n      return subject;\n    },\n\n    fire: function (eventName) {\n      var callbacks = registeredEvents[eventName];\n      if (!callbacks) {\n        return subject;\n      }\n\n      var fireArguments;\n      if (arguments.length > 1) {\n        fireArguments = Array.prototype.splice.call(arguments, 1);\n      }\n      for(var i = 0; i < callbacks.length; ++i) {\n        var callbackInfo = callbacks[i];\n        callbackInfo.callback.apply(callbackInfo.ctx, fireArguments);\n      }\n\n      return subject;\n    }\n  };\n}\n\nfunction validateSubject(subject) {\n  if (!subject) {\n    throw new Error('Eventify cannot use falsy object as events subject');\n  }\n  var reservedWords = ['on', 'fire', 'off'];\n  for (var i = 0; i < reservedWords.length; ++i) {\n    if (subject.hasOwnProperty(reservedWords[i])) {\n      throw new Error(\"Subject cannot be eventified, since it already has property '\" + reservedWords[i] + \"'\");\n    }\n  }\n}\n","/**\r\n * Common utilities\r\n * @module glMatrix\r\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\r\n * Sets the type of array used when creating new vectors and matrices\r\n *\r\n * @param {Type} type Array type, such as Float32Array or Array\r\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\r\n * Convert Degree To Radian\r\n *\r\n * @param {Number} a Angle in Degrees\r\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\r\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\r\n * @module mat4\r\n */\n\n/**\r\n * Creates a new identity mat4\r\n *\r\n * @returns {mat4} a new 4x4 matrix\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a new mat4 initialized with values from an existing matrix\r\n *\r\n * @param {mat4} a matrix to clone\r\n * @returns {mat4} a new 4x4 matrix\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Copy the values from one mat4 to another\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Create a new mat4 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} A new mat4\r\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\r\n * Set the components of a mat4 to the given values\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} out\r\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\r\n * Set a mat4 to the identity matrix\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @returns {mat4} out\r\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Transpose the values of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\r\n * Inverts a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\r\n * Calculates the adjugate of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\r\n * Calculates the determinant of a mat4\r\n *\r\n * @param {mat4} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\r\n * Multiplies two mat4s\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\r\n * Translate a mat4 by the given vector\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {mat4} out\r\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\r\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {vec3} v the vec3 to scale the matrix by\r\n * @returns {mat4} out\r\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Rotates a mat4 by the given angle around the given axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the X axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the Y axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the Z axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.scale(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Scaling vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a given angle around a given axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotate(dest, dest, rad, axis);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the X axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateX(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the Y axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateY(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the Z axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateZ(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation and vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a new mat4 from a dual quat.\r\n *\r\n * @param {mat4} out Matrix\r\n * @param {quat2} a Dual Quaternion\r\n * @returns {mat4} mat4 receiving operation result\r\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\r\n * Returns the translation vector component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslation,\r\n *  the returned vector will be the same as the translation vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive translation component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\r\n * Returns the scaling factor component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslationScale\r\n *  with a normalized Quaternion paramter, the returned vector will be\r\n *  the same as the scaling vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive scaling factor component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\r\n * Returns a quaternion representing the rotational component\r\n *  of a transformation matrix. If a matrix is built with\r\n *  fromRotationTranslation, the returned quaternion will be the\r\n *  same as the quaternion originally supplied.\r\n * @param {quat} out Quaternion to receive the rotation component\r\n * @param {mat4} mat Matrix to be decomposed (input)\r\n * @return {quat} out\r\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     mat4.translate(dest, origin);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *     mat4.translate(dest, negativeOrigin);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @param {vec3} o The origin vector around which to scale and rotate\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Calculates a 4x4 matrix from the given quaternion\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Quaternion to create matrix from\r\n *\r\n * @returns {mat4} out\r\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a frustum matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Number} left Left bound of the frustum\r\n * @param {Number} right Right bound of the frustum\r\n * @param {Number} bottom Bottom bound of the frustum\r\n * @param {Number} top Top bound of the frustum\r\n * @param {Number} near Near bound of the frustum\r\n * @param {Number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\r\n * Generates a perspective projection matrix with the given bounds.\r\n * Passing null/undefined/no value for far will generate infinite projection matrix.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} fovy Vertical field of view in radians\r\n * @param {number} aspect Aspect ratio. typically viewport width/height\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum, can be null or Infinity\r\n * @returns {mat4} out\r\n */\n\nexport function perspective(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\r\n * Generates a perspective projection matrix with the given field of view.\r\n * This is primarily useful for generating projection matrices to be used\r\n * with the still experiemental WebVR API.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\r\n * Generates a orthogonal projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} left Left bound of the frustum\r\n * @param {number} right Right bound of the frustum\r\n * @param {number} bottom Bottom bound of the frustum\r\n * @param {number} top Top bound of the frustum\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function ortho(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\r\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a matrix that makes something look at something else.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n;\n/**\r\n * Returns a string representation of a mat4\r\n *\r\n * @param {mat4} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\n\nexport function str(a) {\n  return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' + a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' + a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';\n}\n/**\r\n * Returns Frobenius norm of a mat4\r\n *\r\n * @param {mat4} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\r\n * Adds two mat4's\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat4} out\r\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\r\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat4} out the receiving vector\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat4} out\r\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\r\n * Alias for {@link mat4.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link mat4.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\r\n * 4 Dimensional Vector\r\n * @module vec4\r\n */\n\n/**\r\n * Creates a new, empty vec4\r\n *\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n\n  return out;\n}\n/**\r\n * Creates a new vec4 initialized with values from an existing vector\r\n *\r\n * @param {vec4} a vector to clone\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Creates a new vec4 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\r\n * Copy the values from one vec4 to another\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the source vector\r\n * @returns {vec4} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Set the components of a vec4 to the given values\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} out\r\n */\n\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\r\n * Adds two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n/**\r\n * Multiplies two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n/**\r\n * Divides two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n/**\r\n * Math.ceil the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to ceil\r\n * @returns {vec4} out\r\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n/**\r\n * Math.floor the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to floor\r\n * @returns {vec4} out\r\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n/**\r\n * Returns the minimum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n/**\r\n * Returns the maximum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n/**\r\n * Math.round the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to round\r\n * @returns {vec4} out\r\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n/**\r\n * Scales a vec4 by a scalar number\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec4} out\r\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n/**\r\n * Adds two vec4's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec4} out\r\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n/**\r\n * Calculates the euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\r\n * Calculates the squared euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\r\n * Calculates the length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\r\n * Calculates the squared length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\r\n * Negates the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to negate\r\n * @returns {vec4} out\r\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n/**\r\n * Returns the inverse of the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to invert\r\n * @returns {vec4} out\r\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n/**\r\n * Normalize a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to normalize\r\n * @returns {vec4} out\r\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n/**\r\n * Calculates the dot product of two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n/**\r\n * Returns the cross-product of three vectors in a 4-dimensional space\r\n *\r\n * @param {vec4} result the receiving vector\r\n * @param {vec4} U the first vector\r\n * @param {vec4} V the second vector\r\n * @param {vec4} W the third vector\r\n * @returns {vec4} result\r\n */\n\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n      B = v[0] * w[2] - v[2] * w[0],\n      C = v[0] * w[3] - v[3] * w[0],\n      D = v[1] * w[2] - v[2] * w[1],\n      E = v[1] * w[3] - v[3] * w[1],\n      F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n;\n/**\r\n * Performs a linear interpolation between two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec4} out\r\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec4} out\r\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0; // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n\n  var v1, v2, v3, v4;\n  var s1, s2;\n\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n/**\r\n * Transforms the vec4 with a mat4.\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec4} out\r\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n/**\r\n * Transforms the vec4 with a quat\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec4} out\r\n */\n\nexport function transformQuat(out, a, q) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3]; // calculate quat * vec\n\n  var ix = qw * x + qy * z - qz * y;\n  var iy = qw * y + qz * x - qx * z;\n  var iz = qw * z + qx * y - qy * x;\n  var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Set the components of a vec4 to zero\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @returns {vec4} out\r\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\n\nexport function str(a) {\n  return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\n}\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n/**\r\n * Alias for {@link vec4.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;\n/**\r\n * Alias for {@link vec4.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link vec4.divide}\r\n * @function\r\n */\n\nexport var div = divide;\n/**\r\n * Alias for {@link vec4.distance}\r\n * @function\r\n */\n\nexport var dist = distance;\n/**\r\n * Alias for {@link vec4.squaredDistance}\r\n * @function\r\n */\n\nexport var sqrDist = squaredDistance;\n/**\r\n * Alias for {@link vec4.length}\r\n * @function\r\n */\n\nexport var len = length;\n/**\r\n * Alias for {@link vec4.squaredLength}\r\n * @function\r\n */\n\nexport var sqrLen = squaredLength;\n/**\r\n * Perform some operation over an array of vec4s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 4;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n\n    return a;\n  };\n}();","import {mat4} from 'gl-matrix';\n/**\n * represents a single element in the scene tree\n */\nclass Element {\n  constructor() {\n    this.children = [];\n    // Transforms local coordinate system to parent coordinate system\n    this.model = mat4.create();\n    // Cumulative transform to webgl coordinate system.\n    this.worldModel = mat4.create();\n    this.worldTransformNeedsUpdate = true;\n\n    this.type = 'Element';\n    this.scene = null;\n  }\n\n  appendChild(child, sendToBack) {\n    child.parent = this;\n    if (sendToBack) {\n      // back of z-index\n      this.children.unshift(child);\n    } else {\n      this.children.push(child);\n    }\n    if (child.bindScene) {\n      child.bindScene(this.scene);\n    }\n\n    if (this.scene) this.scene.renderFrame();\n  }\n\n  bindScene(scene) {\n    this.scene = scene;\n  }\n\n  traverse(enterCallback, exitCallback) {\n    enterCallback(this);\n\n    for (var i = 0; i < this.children.length; ++i) {\n      var child = this.children[i];\n      child.traverse(enterCallback, exitCallback);\n    }\n\n    if (exitCallback) exitCallback(this);\n  }\n\n  rotate(rad, axis) {\n    mat4.rotate(this.model, this.model, rad, axis);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  rotateX(rad) {\n    mat4.rotateX(this.model, this.model, rad);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  rotateY(rad) {\n    mat4.rotateY(this.model, this.model, rad);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  rotateZ(rad) {\n    mat4.rotateZ(this.model, this.model, rad);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  scale(v) {\n    mat4.scale(this.model, this.model, v);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  translate(v) {\n    mat4.translate(this.model, this.model, v);\n    this.worldTransformNeedsUpdate = true;\n    if (this.scene) this.scene.renderFrame();\n    return this;\n  }\n\n  removeChild(child) {\n    // TODO: should this be faster?\n    let childIdx = this.children.indexOf(child);\n    if (childIdx > -1) {\n      this.children.splice(childIdx, 1);\n    }\n\n    if (this.scene) this.scene.renderFrame();\n  }\n\n  updateWorldTransform(force) {\n    if (this.worldTransformNeedsUpdate || force) {\n      if (this.parent) {\n        mat4.multiply(this.worldModel, this.parent.worldModel, this.model);\n      } else {\n        mat4.copy(this.worldModel, this.model);\n      }\n\n      this.worldTransformNeedsUpdate = false;\n      force = true; // We have to update children now.\n    }\n\n    let wasDirty = force;\n\n    var children = this.children;\n    for (var i = 0; i < children.length; i++ ) {\n       wasDirty = children[i].updateWorldTransform(force) || wasDirty;\n    }\n\n    return wasDirty;\n  }\n\n  draw(gl, screen) {\n    for (var i = 0; i < this.children.length; ++i) {\n      var child = this.children[i];\n      child.draw(gl, screen);\n    }\n  }\n\n  dispose() {\n    for (var i = 0; i < this.children.length; ++i) {\n      var child = this.children[i];\n      child.dispose();\n    }\n  }\n}\n\nexport default Element;","var config = {\n  maxSingleTouchTime: 300, // ms\n  singleTapDistanceSquared: 25 // within 5px we consider it as a single tap\n}\n\nexport default onClap;\n\nfunction onClap(element, callback, ctx) {\n  var touchStartTime = new Date();\n  var startPos\n\n  element.addEventListener('click', invokeHandler, {passive: false})\n\n  element.addEventListener('touchend', handleTouchEnd, {passive: false})\n  element.addEventListener('touchstart', handleTouchStart, {passive: false})\n\n  return disposePrevHandler;\n\n  function handleTouchStart(e) {\n    var touches = e.touches\n\n    if (touches.length === 1) {\n      touchStartTime = new Date()\n      startPos = {\n        x: e.touches[0].pageX,\n        y: e.touches[0].pageY\n      }\n    }\n  }\n\n  function handleTouchEnd(e) {\n    // multitouch - ignore\n    if (e.touches.length > 1) return\n\n    // single touch - use time difference to determine if it was a touch or\n    // a swipe\n    var dt = new Date() - touchStartTime\n\n    // To long - ignore\n    if (dt > config.maxSingleTouchTime) return\n    let touch = e.changedTouches[0];\n\n    var dx = touch.pageX - startPos.x\n    var dy = touch.pageY - startPos.y\n\n    if (dx * dx + dy * dy < config.singleTapDistanceSquared) {\n      invokeHandler(touch)\n    }\n  }\n\n  function disposePrevHandler() {\n    element.removeEventListener('click', invokeHandler)\n    element.removeEventListener('touchend', handleTouchEnd)\n    element.removeEventListener('touchstart', handleTouchStart)\n  }\n\n  function invokeHandler(e) {\n    callback.call(ctx, e)\n  }\n}","/**\n * This module used to unify mouse wheel behavior between different browsers in 2014\n * Now it's just a wrapper around addEventListener('wheel');\n *\n * Usage:\n *  var addWheelListener = require('wheel').addWheelListener;\n *  var removeWheelListener = require('wheel').removeWheelListener;\n *  addWheelListener(domElement, function (e) {\n *    // mouse wheel event\n *  });\n *  removeWheelListener(domElement, function);\n */\n\nmodule.exports = addWheelListener;\n\n// But also expose \"advanced\" api with unsubscribe:\nmodule.exports.addWheelListener = addWheelListener;\nmodule.exports.removeWheelListener = removeWheelListener;\n\n\nfunction addWheelListener(element, listener, useCapture) {\n  element.addEventListener('wheel', listener, useCapture);\n}\n\nfunction removeWheelListener( element, listener, useCapture ) {\n  element.removeEventListener('wheel', listener, useCapture);\n}","/**\n * https://github.com/gre/bezier-easing\n * BezierEasing - use bezier curve for transition easing function\n * by Gatan Renaudeau 2014 - 2015  MIT License\n */\n\n// These values are established by empiricism with tests (tradeoff: performance VS precision)\nvar NEWTON_ITERATIONS = 4;\nvar NEWTON_MIN_SLOPE = 0.001;\nvar SUBDIVISION_PRECISION = 0.0000001;\nvar SUBDIVISION_MAX_ITERATIONS = 10;\n\nvar kSplineTableSize = 11;\nvar kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\n\nvar float32ArraySupported = typeof Float32Array === 'function';\n\nfunction A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\nfunction B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }\nfunction C (aA1)      { return 3.0 * aA1; }\n\n// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\nfunction calcBezier (aT, aA1, aA2) { return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT; }\n\n// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\nfunction getSlope (aT, aA1, aA2) { return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1); }\n\nfunction binarySubdivide (aX, aA, aB, mX1, mX2) {\n  var currentX, currentT, i = 0;\n  do {\n    currentT = aA + (aB - aA) / 2.0;\n    currentX = calcBezier(currentT, mX1, mX2) - aX;\n    if (currentX > 0.0) {\n      aB = currentT;\n    } else {\n      aA = currentT;\n    }\n  } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\n  return currentT;\n}\n\nfunction newtonRaphsonIterate (aX, aGuessT, mX1, mX2) {\n for (var i = 0; i < NEWTON_ITERATIONS; ++i) {\n   var currentSlope = getSlope(aGuessT, mX1, mX2);\n   if (currentSlope === 0.0) {\n     return aGuessT;\n   }\n   var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n   aGuessT -= currentX / currentSlope;\n }\n return aGuessT;\n}\n\nfunction LinearEasing (x) {\n  return x;\n}\n\nmodule.exports = function bezier (mX1, mY1, mX2, mY2) {\n  if (!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) {\n    throw new Error('bezier x values must be in [0, 1] range');\n  }\n\n  if (mX1 === mY1 && mX2 === mY2) {\n    return LinearEasing;\n  }\n\n  // Precompute samples table\n  var sampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\n  for (var i = 0; i < kSplineTableSize; ++i) {\n    sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n  }\n\n  function getTForX (aX) {\n    var intervalStart = 0.0;\n    var currentSample = 1;\n    var lastSample = kSplineTableSize - 1;\n\n    for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {\n      intervalStart += kSampleStepSize;\n    }\n    --currentSample;\n\n    // Interpolate to provide an initial guess for t\n    var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);\n    var guessForT = intervalStart + dist * kSampleStepSize;\n\n    var initialSlope = getSlope(guessForT, mX1, mX2);\n    if (initialSlope >= NEWTON_MIN_SLOPE) {\n      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\n    } else if (initialSlope === 0.0) {\n      return guessForT;\n    } else {\n      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\n    }\n  }\n\n  return function BezierEasing (x) {\n    // Because JavaScript number are imprecise, we should guarantee the extremes are right.\n    if (x === 0) {\n      return 0;\n    }\n    if (x === 1) {\n      return 1;\n    }\n    return calcBezier(getTForX(x), mY1, mY2);\n  };\n};\n","var BezierEasing = require('bezier-easing')\n\n// Predefined set of animations. Similar to CSS easing functions\nvar animations = {\n  ease:  BezierEasing(0.25, 0.1, 0.25, 1),\n  easeIn: BezierEasing(0.42, 0, 1, 1),\n  easeOut: BezierEasing(0, 0, 0.58, 1),\n  easeInOut: BezierEasing(0.42, 0, 0.58, 1),\n  linear: BezierEasing(0, 0, 1, 1)\n}\n\n\nmodule.exports = animate;\nmodule.exports.makeAggregateRaf = makeAggregateRaf;\nmodule.exports.sharedScheduler = makeAggregateRaf();\n\n\nfunction animate(source, target, options) {\n  var start = Object.create(null)\n  var diff = Object.create(null)\n  options = options || {}\n  // We let clients specify their own easing function\n  var easing = (typeof options.easing === 'function') ? options.easing : animations[options.easing]\n\n  // if nothing is specified, default to ease (similar to CSS animations)\n  if (!easing) {\n    if (options.easing) {\n      console.warn('Unknown easing function in amator: ' + options.easing);\n    }\n    easing = animations.ease\n  }\n\n  var step = typeof options.step === 'function' ? options.step : noop\n  var done = typeof options.done === 'function' ? options.done : noop\n\n  var scheduler = getScheduler(options.scheduler)\n\n  var keys = Object.keys(target)\n  keys.forEach(function(key) {\n    start[key] = source[key]\n    diff[key] = target[key] - source[key]\n  })\n\n  var durationInMs = typeof options.duration === 'number' ? options.duration : 400\n  var durationInFrames = Math.max(1, durationInMs * 0.06) // 0.06 because 60 frames pers 1,000 ms\n  var previousAnimationId\n  var frame = 0\n\n  previousAnimationId = scheduler.next(loop)\n\n  return {\n    cancel: cancel\n  }\n\n  function cancel() {\n    scheduler.cancel(previousAnimationId)\n    previousAnimationId = 0\n  }\n\n  function loop() {\n    var t = easing(frame/durationInFrames)\n    frame += 1\n    setValues(t)\n    if (frame <= durationInFrames) {\n      previousAnimationId = scheduler.next(loop)\n      step(source)\n    } else {\n      previousAnimationId = 0\n      setTimeout(function() { done(source) }, 0)\n    }\n  }\n\n  function setValues(t) {\n    keys.forEach(function(key) {\n      source[key] = diff[key] * t + start[key]\n    })\n  }\n}\n\nfunction noop() { }\n\nfunction getScheduler(scheduler) {\n  if (!scheduler) {\n    var canRaf = typeof window !== 'undefined' && window.requestAnimationFrame\n    return canRaf ? rafScheduler() : timeoutScheduler()\n  }\n  if (typeof scheduler.next !== 'function') throw new Error('Scheduler is supposed to have next(cb) function')\n  if (typeof scheduler.cancel !== 'function') throw new Error('Scheduler is supposed to have cancel(handle) function')\n\n  return scheduler\n}\n\nfunction rafScheduler() {\n  return {\n    next: window.requestAnimationFrame.bind(window),\n    cancel: window.cancelAnimationFrame.bind(window)\n  }\n}\n\nfunction timeoutScheduler() {\n  return {\n    next: function(cb) {\n      return setTimeout(cb, 1000/60)\n    },\n    cancel: function (id) {\n      return clearTimeout(id)\n    }\n  }\n}\n\nfunction makeAggregateRaf() {\n  var frontBuffer = new Set();\n  var backBuffer = new Set();\n  var frameToken = 0;\n\n  return {\n    next: next,\n    cancel: next,\n    clearAll: clearAll\n  }\n\n  function clearAll() {\n    frontBuffer.clear();\n    backBuffer.clear();\n    cancelAnimationFrame(frameToken);\n    frameToken = 0;\n  }\n\n  function next(callback) {\n    backBuffer.add(callback);\n    renderNextFrame();\n  }\n\n  function renderNextFrame() {\n    if (!frameToken) frameToken = requestAnimationFrame(renderFrame);\n  }\n\n  function renderFrame() {\n    frameToken = 0;\n\n    var t = backBuffer;\n    backBuffer = frontBuffer;\n    frontBuffer = t;\r\n\n    frontBuffer.forEach(function(callback) {\n      callback();\n    });\n    frontBuffer.clear();\n  }\n\n  function cancel(callback) {\n    backBuffer.delete(callback);\n  }\n}\n","/**\n * Allows smooth kinetic scrolling of the surface\n */\nmodule.exports = kinetic;\n\nfunction kinetic(getPoint, scroll, settings) {\n  if (typeof settings !== 'object') {\n    // setting could come as boolean, we should ignore it, and use an object.\n    settings = {};\n  }\n\n  var minVelocity = typeof settings.minVelocity === 'number' ? settings.minVelocity : 5;\n  var amplitude = typeof settings.amplitude === 'number' ? settings.amplitude : 0.25;\n  var cancelAnimationFrame = typeof settings.cancelAnimationFrame === 'function' ? settings.cancelAnimationFrame : getCancelAnimationFrame();\n  var requestAnimationFrame = typeof settings.requestAnimationFrame === 'function' ? settings.requestAnimationFrame : getRequestAnimationFrame();\n\n  var lastPoint;\n  var timestamp;\n  var timeConstant = 342;\n\n  var ticker;\n  var vx, targetX, ax;\n  var vy, targetY, ay;\n\n  var raf;\n\n  return {\n    start: start,\n    stop: stop,\n    cancel: dispose\n  };\n\n  function dispose() {\n    cancelAnimationFrame(ticker);\n    cancelAnimationFrame(raf);\n  }\n\n  function start() {\n    lastPoint = getPoint();\n\n    ax = ay = vx = vy = 0;\n    timestamp = new Date();\n\n    cancelAnimationFrame(ticker);\n    cancelAnimationFrame(raf);\n\n    // we start polling the point position to accumulate velocity\n    // Once we stop(), we will use accumulated velocity to keep scrolling\n    // an object.\n    ticker = requestAnimationFrame(track);\n  }\n\n  function track() {\n    var now = Date.now();\n    var elapsed = now - timestamp;\n    timestamp = now;\n\n    var currentPoint = getPoint();\n\n    var dx = currentPoint.x - lastPoint.x;\n    var dy = currentPoint.y - lastPoint.y;\n\n    lastPoint = currentPoint;\n\n    var dt = 1000 / (1 + elapsed);\n\n    // moving average\n    vx = 0.8 * dx * dt + 0.2 * vx;\n    vy = 0.8 * dy * dt + 0.2 * vy;\n\n    ticker = requestAnimationFrame(track);\n  }\n\n  function stop() {\n    cancelAnimationFrame(ticker);\n    cancelAnimationFrame(raf);\n\n    var currentPoint = getPoint();\n\n    targetX = currentPoint.x;\n    targetY = currentPoint.y;\n    timestamp = Date.now();\n\n    if (vx < -minVelocity || vx > minVelocity) {\n      ax = amplitude * vx;\n      targetX += ax;\n    }\n\n    if (vy < -minVelocity || vy > minVelocity) {\n      ay = amplitude * vy;\n      targetY += ay;\n    }\n\n    raf = requestAnimationFrame(autoScroll);\n  }\n\n  function autoScroll() {\n    var elapsed = Date.now() - timestamp;\n\n    var moving = false;\n    var dx = 0;\n    var dy = 0;\n\n    if (ax) {\n      dx = -ax * Math.exp(-elapsed / timeConstant);\n\n      if (dx > 0.5 || dx < -0.5) moving = true;\n      else dx = ax = 0;\n    }\n\n    if (ay) {\n      dy = -ay * Math.exp(-elapsed / timeConstant);\n\n      if (dy > 0.5 || dy < -0.5) moving = true;\n      else dy = ay = 0;\n    }\n\n    if (moving) {\n      scroll(targetX + dx, targetY + dy);\n      raf = requestAnimationFrame(autoScroll);\n    }\n  }\n}\n\nfunction getCancelAnimationFrame() {\n  if (typeof global.cancelAnimationFrame === 'function') return global.cancelAnimationFrame;\n\n  return clearTimeout;\n}\n\nfunction getRequestAnimationFrame() {\n  if (typeof global.requestAnimationFrame === 'function') return global.requestAnimationFrame;\n\n  return function (handler) {\n    return setTimeout(handler, 16);\n  }\n}","/**\n * Disallows selecting text.\n */\nmodule.exports = createTextSelectionInterceptor;\n\nfunction createTextSelectionInterceptor(useFake) {\n  if (useFake) {\n    return {\n      capture: noop,\n      release: noop\n    };\n  }\n\n  var dragObject;\n  var prevSelectStart;\n  var prevDragStart;\n  var wasCaptured = false;\n\n  return {\n    capture: capture,\n    release: release\n  };\n\n  function capture(domObject) {\n    wasCaptured = true;\n    prevSelectStart = window.document.onselectstart;\n    prevDragStart = window.document.ondragstart;\n\n    window.document.onselectstart = disabled;\n\n    dragObject = domObject;\n    dragObject.ondragstart = disabled;\n  }\n\n  function release() {\n    if (!wasCaptured) return;\n    \n    wasCaptured = false;\n    window.document.onselectstart = prevSelectStart;\n    if (dragObject) dragObject.ondragstart = prevDragStart;\n  }\n}\n\nfunction disabled(e) {\n  e.stopPropagation();\n  return false;\n}\n\nfunction noop() {}\n","module.exports = Transform;\n\nfunction Transform() {\n  this.x = 0;\n  this.y = 0;\n  this.scale = 1;\n}\n","module.exports = makeSvgController\n\nfunction makeSvgController(svgElement, options) {\n  var elementValid = (svgElement instanceof SVGElement)\n  if (!elementValid) {\n    throw new Error('svg element is required for svg.panzoom to work')\n  }\n\n  var owner = svgElement.ownerSVGElement\n  if (!owner) {\n    throw new Error(\n      'Do not apply panzoom to the root <svg> element. ' +\n      'Use its child instead (e.g. <g></g>). ' +\n      'As of March 2016 only FireFox supported transform on the root element')\n  }\n\n  if (!options.disableKeyboardInteraction) {\n    owner.setAttribute('tabindex', 0);\n  }\n\n  var api = {\n    getBBox: getBBox,\n    getScreenCTM: getScreenCTM,\n    getOwner: getOwner,\n    applyTransform: applyTransform,\n    initTransform: initTransform\n  }\n  \n  return api\n\n  function getOwner() {\n    return owner\n  }\n\n  function getBBox() {\n    var bbox =  svgElement.getBBox()\n    return {\n      left: bbox.x,\n      top: bbox.y,\n      width: bbox.width,\n      height: bbox.height,\n    }\n  }\n\n  function getScreenCTM() {\n    var ctm = owner.getCTM();\n    if (!ctm) {\n      // This is likely firefox: https://bugzilla.mozilla.org/show_bug.cgi?id=873106\n      // The code below is not entirely correct, but still better than nothing\n      return owner.getScreenCTM();\n    }\n    return ctm;\n  }\n\n  function initTransform(transform) {\n    var screenCTM = svgElement.getCTM()\n    transform.x = screenCTM.e;\n    transform.y = screenCTM.f;\n    transform.scale = screenCTM.a;\n    owner.removeAttributeNS(null, 'viewBox');\n  }\n\n  function applyTransform(transform) {\n    svgElement.setAttribute('transform', 'matrix(' +\n      transform.scale + ' 0 0 ' +\n      transform.scale + ' ' +\n      transform.x + ' ' + transform.y + ')')\n  }\n}","module.exports = makeDomController\n\nfunction makeDomController(domElement, options) {\n  var elementValid = (domElement instanceof HTMLElement)\n  if (!elementValid) {\n    throw new Error('svg element is required for svg.panzoom to work')\n  }\n\n  var owner = domElement.parentElement\n  if (!owner) {\n    throw new Error(\n      'Do not apply panzoom to the detached DOM element. '\n    )\n  }\n\n  domElement.scrollTop = 0;\n  \n  if (!options.disableKeyboardInteraction) {\n    owner.setAttribute('tabindex', 0);\n  }\n\n  var api = {\n    getBBox: getBBox,\n    getOwner: getOwner,\n    applyTransform: applyTransform,\n  }\n  \n  return api\n\n  function getOwner() {\n    return owner\n  }\n\n  function getBBox() {\n    // TODO: We should probably cache this?\n    return  {\n      left: 0,\n      top: 0,\n      width: domElement.clientWidth,\n      height: domElement.clientHeight\n    }\n  }\n\n  function applyTransform(transform) {\n    // TODO: Should we cache this?\n    domElement.style.transformOrigin = '0 0 0';\n    domElement.style.transform = 'matrix(' +\n      transform.scale + ', 0, 0, ' +\n      transform.scale + ', ' +\n      transform.x + ', ' + transform.y + ')'\n  }\n}\n","'use strict';\n\n/* globals SVGElement */\n/**\n * Allows to drag and zoom svg elements\n */\nvar wheel = require('wheel');\nvar animate = require('amator');\nvar eventify = require('ngraph.events');\nvar kinetic = require('./lib/kinetic.js');\nvar createTextSelectionInterceptor = require('./lib/createTextSelectionInterceptor.js');\nvar domTextSelectionInterceptor = createTextSelectionInterceptor();\nvar fakeTextSelectorInterceptor = createTextSelectionInterceptor(true);\nvar Transform = require('./lib/transform.js');\nvar makeSvgController = require('./lib/svgController.js');\nvar makeDomController = require('./lib/domController.js');\n\nvar defaultZoomSpeed = 1;\nvar defaultDoubleTapZoomSpeed = 1.75;\nvar doubleTapSpeedInMS = 300;\n\nmodule.exports = createPanZoom;\n\n/**\n * Creates a new instance of panzoom, so that an object can be panned and zoomed\n *\n * @param {DOMElement} domElement where panzoom should be attached.\n * @param {Object} options that configure behavior.\n */\nfunction createPanZoom(domElement, options) {\n  options = options || {};\n\n  var panController = options.controller;\n\n  if (!panController) {\n    if (domElement instanceof SVGElement) {\n      panController = makeSvgController(domElement, options);\n    }\n\n    if (domElement instanceof HTMLElement) {\n      panController = makeDomController(domElement, options);\n    }\n  }\n\n  if (!panController) {\n    throw new Error(\n      'Cannot create panzoom for the current type of dom element'\n    );\n  }\n  var owner = panController.getOwner();\n  // just to avoid GC pressure, every time we do intermediate transform\n  // we return this object. For internal use only. Never give it back to the consumer of this library\n  var storedCTMResult = { x: 0, y: 0 };\n\n  var isDirty = false;\n  var transform = new Transform();\n\n  if (panController.initTransform) {\n    panController.initTransform(transform);\n  }\n\n  var filterKey = typeof options.filterKey === 'function' ? options.filterKey : noop;\n  // TODO: likely need to unite pinchSpeed with zoomSpeed\n  var pinchSpeed = typeof options.pinchSpeed === 'number' ? options.pinchSpeed : 1;\n  var bounds = options.bounds;\n  var maxZoom = typeof options.maxZoom === 'number' ? options.maxZoom : Number.POSITIVE_INFINITY;\n  var minZoom = typeof options.minZoom === 'number' ? options.minZoom : 0;\n\n  var boundsPadding = typeof options.boundsPadding === 'number' ? options.boundsPadding : 0.05;\n  var zoomDoubleClickSpeed = typeof options.zoomDoubleClickSpeed === 'number' ? options.zoomDoubleClickSpeed : defaultDoubleTapZoomSpeed;\n  var beforeWheel = options.beforeWheel || noop;\n  var beforeMouseDown = options.beforeMouseDown || noop;\n  var speed = typeof options.zoomSpeed === 'number' ? options.zoomSpeed : defaultZoomSpeed;\n  var transformOrigin = parseTransformOrigin(options.transformOrigin);\n  var textSelection = options.enableTextSelection ? fakeTextSelectorInterceptor : domTextSelectionInterceptor;\n\n  validateBounds(bounds);\n\n  if (options.autocenter) {\n    autocenter();\n  }\n\n  var frameAnimation;\n  var lastTouchEndTime = 0;\n  var touchInProgress = false;\n\n  // We only need to fire panstart when actual move happens\n  var panstartFired = false;\n\n  // cache mouse coordinates here\n  var mouseX;\n  var mouseY;\n\n  var pinchZoomLength;\n\n  var smoothScroll;\n  if ('smoothScroll' in options && !options.smoothScroll) {\n    // If user explicitly asked us not to use smooth scrolling, we obey\n    smoothScroll = rigidScroll();\n  } else {\n    // otherwise we use forward smoothScroll settings to kinetic API\n    // which makes scroll smoothing.\n    smoothScroll = kinetic(getPoint, scroll, options.smoothScroll);\n  }\n\n  var moveByAnimation;\n  var zoomToAnimation;\n\n  var multiTouch;\n  var paused = false;\n\n  listenForEvents();\n\n  var api = {\n    dispose: dispose,\n    moveBy: internalMoveBy,\n    moveTo: moveTo,\n    centerOn: centerOn,\n    zoomTo: publicZoomTo,\n    zoomAbs: zoomAbs,\n    smoothZoom: smoothZoom,\n    smoothZoomAbs: smoothZoomAbs,\n    showRectangle: showRectangle,\n\n    pause: pause,\n    resume: resume,\n    isPaused: isPaused,\n\n    getTransform: getTransformModel,\n\n    getMinZoom: getMinZoom,\n    setMinZoom: setMinZoom,\n\n    getMaxZoom: getMaxZoom,\n    setMaxZoom: setMaxZoom,\n\n    getTransformOrigin: getTransformOrigin,\n    setTransformOrigin: setTransformOrigin,\n\n    getZoomSpeed: getZoomSpeed,\n    setZoomSpeed: setZoomSpeed\n  };\n\n  eventify(api);\n\n  return api;\n\n  function pause() {\n    releaseEvents();\n    paused = true;\n  }\n\n  function resume() {\n    if (paused) {\n      listenForEvents();\n      paused = false;\n    }\n  }\n\n  function isPaused() {\n    return paused;\n  }\n\n  function showRectangle(rect) {\n    // TODO: this duplicates autocenter. I think autocenter should go.\n    var clientRect = owner.getBoundingClientRect();\n    var size = transformToScreen(clientRect.width, clientRect.height);\n\n    var rectWidth = rect.right - rect.left;\n    var rectHeight = rect.bottom - rect.top;\n    if (!Number.isFinite(rectWidth) || !Number.isFinite(rectHeight)) {\n      throw new Error('Invalid rectangle');\n    }\n\n    var dw = size.x / rectWidth;\n    var dh = size.y / rectHeight;\n    var scale = Math.min(dw, dh);\n    transform.x = -(rect.left + rectWidth / 2) * scale + size.x / 2;\n    transform.y = -(rect.top + rectHeight / 2) * scale + size.y / 2;\n    transform.scale = scale;\n  }\n\n  function transformToScreen(x, y) {\n    if (panController.getScreenCTM) {\n      var parentCTM = panController.getScreenCTM();\n      var parentScaleX = parentCTM.a;\n      var parentScaleY = parentCTM.d;\n      var parentOffsetX = parentCTM.e;\n      var parentOffsetY = parentCTM.f;\n      storedCTMResult.x = x * parentScaleX - parentOffsetX;\n      storedCTMResult.y = y * parentScaleY - parentOffsetY;\n    } else {\n      storedCTMResult.x = x;\n      storedCTMResult.y = y;\n    }\n\n    return storedCTMResult;\n  }\n\n  function autocenter() {\n    var w; // width of the parent\n    var h; // height of the parent\n    var left = 0;\n    var top = 0;\n    var sceneBoundingBox = getBoundingBox();\n    if (sceneBoundingBox) {\n      // If we have bounding box - use it.\n      left = sceneBoundingBox.left;\n      top = sceneBoundingBox.top;\n      w = sceneBoundingBox.right - sceneBoundingBox.left;\n      h = sceneBoundingBox.bottom - sceneBoundingBox.top;\n    } else {\n      // otherwise just use whatever space we have\n      var ownerRect = owner.getBoundingClientRect();\n      w = ownerRect.width;\n      h = ownerRect.height;\n    }\n    var bbox = panController.getBBox();\n    if (bbox.width === 0 || bbox.height === 0) {\n      // we probably do not have any elements in the SVG\n      // just bail out;\n      return;\n    }\n    var dh = h / bbox.height;\n    var dw = w / bbox.width;\n    var scale = Math.min(dw, dh);\n    transform.x = -(bbox.left + bbox.width / 2) * scale + w / 2 + left;\n    transform.y = -(bbox.top + bbox.height / 2) * scale + h / 2 + top;\n    transform.scale = scale;\n  }\n\n  function getTransformModel() {\n    // TODO: should this be read only?\n    return transform;\n  }\n\n  function getMinZoom() {\n    return minZoom;\n  }\n\n  function setMinZoom(newMinZoom) {\n    minZoom = newMinZoom;\n  }\n\n  function getMaxZoom() {\n    return maxZoom;\n  }\n\n  function setMaxZoom(newMaxZoom) {\n    maxZoom = newMaxZoom;\n  }\n\n  function getTransformOrigin() {\n    return transformOrigin;\n  }\n\n  function setTransformOrigin(newTransformOrigin) {\n    transformOrigin = parseTransformOrigin(newTransformOrigin);\n  }\n\n  function getZoomSpeed() {\n    return speed;\n  }\n\n  function setZoomSpeed(newSpeed) {\n    if (!Number.isFinite(newSpeed)) {\n      throw new Error('Zoom speed should be a number');\n    }\n    speed = newSpeed;\n  }\n\n  function getPoint() {\n    return {\n      x: transform.x,\n      y: transform.y\n    };\n  }\n\n  function moveTo(x, y) {\n    transform.x = x;\n    transform.y = y;\n\n    keepTransformInsideBounds();\n\n    triggerEvent('pan');\n    makeDirty();\n  }\n\n  function moveBy(dx, dy) {\n    moveTo(transform.x + dx, transform.y + dy);\n  }\n\n  function keepTransformInsideBounds() {\n    var boundingBox = getBoundingBox();\n    if (!boundingBox) return;\n\n    var adjusted = false;\n    var clientRect = getClientRect();\n\n    var diff = boundingBox.left - clientRect.right;\n    if (diff > 0) {\n      transform.x += diff;\n      adjusted = true;\n    }\n    // check the other side:\n    diff = boundingBox.right - clientRect.left;\n    if (diff < 0) {\n      transform.x += diff;\n      adjusted = true;\n    }\n\n    // y axis:\n    diff = boundingBox.top - clientRect.bottom;\n    if (diff > 0) {\n      // we adjust transform, so that it matches exactly our bounding box:\n      // transform.y = boundingBox.top - (boundingBox.height + boundingBox.y) * transform.scale =>\n      // transform.y = boundingBox.top - (clientRect.bottom - transform.y) =>\n      // transform.y = diff + transform.y =>\n      transform.y += diff;\n      adjusted = true;\n    }\n\n    diff = boundingBox.bottom - clientRect.top;\n    if (diff < 0) {\n      transform.y += diff;\n      adjusted = true;\n    }\n    return adjusted;\n  }\n\n  /**\n   * Returns bounding box that should be used to restrict scene movement.\n   */\n  function getBoundingBox() {\n    if (!bounds) return; // client does not want to restrict movement\n\n    if (typeof bounds === 'boolean') {\n      // for boolean type we use parent container bounds\n      var ownerRect = owner.getBoundingClientRect();\n      var sceneWidth = ownerRect.width;\n      var sceneHeight = ownerRect.height;\n\n      return {\n        left: sceneWidth * boundsPadding,\n        top: sceneHeight * boundsPadding,\n        right: sceneWidth * (1 - boundsPadding),\n        bottom: sceneHeight * (1 - boundsPadding)\n      };\n    }\n\n    return bounds;\n  }\n\n  function getClientRect() {\n    var bbox = panController.getBBox();\n    var leftTop = client(bbox.left, bbox.top);\n\n    return {\n      left: leftTop.x,\n      top: leftTop.y,\n      right: bbox.width * transform.scale + leftTop.x,\n      bottom: bbox.height * transform.scale + leftTop.y\n    };\n  }\n\n  function client(x, y) {\n    return {\n      x: x * transform.scale + transform.x,\n      y: y * transform.scale + transform.y\n    };\n  }\n\n  function makeDirty() {\n    isDirty = true;\n    frameAnimation = window.requestAnimationFrame(frame);\n  }\n\n  function zoomByRatio(clientX, clientY, ratio) {\n    if (isNaN(clientX) || isNaN(clientY) || isNaN(ratio)) {\n      throw new Error('zoom requires valid numbers');\n    }\n\n    var newScale = transform.scale * ratio;\n\n    if (newScale < minZoom) {\n      if (transform.scale === minZoom) return;\n\n      ratio = minZoom / transform.scale;\n    }\n    if (newScale > maxZoom) {\n      if (transform.scale === maxZoom) return;\n\n      ratio = maxZoom / transform.scale;\n    }\n\n    var size = transformToScreen(clientX, clientY);\n\n    transform.x = size.x - ratio * (size.x - transform.x);\n    transform.y = size.y - ratio * (size.y - transform.y);\n\n    // TODO: https://github.com/anvaka/panzoom/issues/112\n    if (bounds && boundsPadding === 1 && minZoom === 1) {\n      transform.scale *= ratio;\n      keepTransformInsideBounds();\n    } else {\n      var transformAdjusted = keepTransformInsideBounds();\n      if (!transformAdjusted) transform.scale *= ratio;\n    }\n\n    triggerEvent('zoom');\n\n    makeDirty();\n  }\n\n  function zoomAbs(clientX, clientY, zoomLevel) {\n    var ratio = zoomLevel / transform.scale;\n    zoomByRatio(clientX, clientY, ratio);\n  }\n\n  function centerOn(ui) {\n    var parent = ui.ownerSVGElement;\n    if (!parent)\n      throw new Error('ui element is required to be within the scene');\n\n    // TODO: should i use controller's screen CTM?\n    var clientRect = ui.getBoundingClientRect();\n    var cx = clientRect.left + clientRect.width / 2;\n    var cy = clientRect.top + clientRect.height / 2;\n\n    var container = parent.getBoundingClientRect();\n    var dx = container.width / 2 - cx;\n    var dy = container.height / 2 - cy;\n\n    internalMoveBy(dx, dy, true);\n  }\n\n  function internalMoveBy(dx, dy, smooth) {\n    if (!smooth) {\n      return moveBy(dx, dy);\n    }\n\n    if (moveByAnimation) moveByAnimation.cancel();\n\n    var from = { x: 0, y: 0 };\n    var to = { x: dx, y: dy };\n    var lastX = 0;\n    var lastY = 0;\n\n    moveByAnimation = animate(from, to, {\n      step: function (v) {\n        moveBy(v.x - lastX, v.y - lastY);\n\n        lastX = v.x;\n        lastY = v.y;\n      }\n    });\n  }\n\n  function scroll(x, y) {\n    cancelZoomAnimation();\n    moveTo(x, y);\n  }\n\n  function dispose() {\n    releaseEvents();\n  }\n\n  function listenForEvents() {\n    owner.addEventListener('mousedown', onMouseDown, { passive: false });\n    owner.addEventListener('dblclick', onDoubleClick, { passive: false });\n    owner.addEventListener('touchstart', onTouch, { passive: false });\n    owner.addEventListener('keydown', onKeyDown, { passive: false });\n\n    // Need to listen on the owner container, so that we are not limited\n    // by the size of the scrollable domElement\n    wheel.addWheelListener(owner, onMouseWheel, { passive: false });\n\n    makeDirty();\n  }\n\n  function releaseEvents() {\n    wheel.removeWheelListener(owner, onMouseWheel);\n    owner.removeEventListener('mousedown', onMouseDown);\n    owner.removeEventListener('keydown', onKeyDown);\n    owner.removeEventListener('dblclick', onDoubleClick);\n    owner.removeEventListener('touchstart', onTouch);\n\n    if (frameAnimation) {\n      window.cancelAnimationFrame(frameAnimation);\n      frameAnimation = 0;\n    }\n\n    smoothScroll.cancel();\n\n    releaseDocumentMouse();\n    releaseTouches();\n    textSelection.release();\n\n    triggerPanEnd();\n  }\n\n  function frame() {\n    if (isDirty) applyTransform();\n  }\n\n  function applyTransform() {\n    isDirty = false;\n\n    // TODO: Should I allow to cancel this?\n    panController.applyTransform(transform);\n\n    triggerEvent('transform');\n    frameAnimation = 0;\n  }\n\n  function onKeyDown(e) {\n    var x = 0,\n      y = 0,\n      z = 0;\n    if (e.keyCode === 38) {\n      y = 1; // up\n    } else if (e.keyCode === 40) {\n      y = -1; // down\n    } else if (e.keyCode === 37) {\n      x = 1; // left\n    } else if (e.keyCode === 39) {\n      x = -1; // right\n    } else if (e.keyCode === 189 || e.keyCode === 109) {\n      // DASH or SUBTRACT\n      z = 1; // `-` -  zoom out\n    } else if (e.keyCode === 187 || e.keyCode === 107) {\n      // EQUAL SIGN or ADD\n      z = -1; // `=` - zoom in (equal sign on US layout is under `+`)\n    }\n\n    if (filterKey(e, x, y, z)) {\n      // They don't want us to handle the key: https://github.com/anvaka/panzoom/issues/45\n      return;\n    }\n\n    if (x || y) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var clientRect = owner.getBoundingClientRect();\n      // movement speed should be the same in both X and Y direction:\n      var offset = Math.min(clientRect.width, clientRect.height);\n      var moveSpeedRatio = 0.05;\n      var dx = offset * moveSpeedRatio * x;\n      var dy = offset * moveSpeedRatio * y;\n\n      // TODO: currently we do not animate this. It could be better to have animation\n      internalMoveBy(dx, dy);\n    }\n\n    if (z) {\n      var scaleMultiplier = getScaleMultiplier(z * 100);\n      var offset = transformOrigin ? getTransformOriginOffset() : midPoint();\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n    }\n  }\n\n  function midPoint() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width / 2,\n      y: ownerRect.height / 2\n    };\n  }\n\n  function onTouch(e) {\n    // let the override the touch behavior\n    beforeTouch(e);\n\n    if (e.touches.length === 1) {\n      return handleSingleFingerTouch(e, e.touches[0]);\n    } else if (e.touches.length === 2) {\n      // handleTouchMove() will care about pinch zoom.\n      pinchZoomLength = getPinchZoomLength(e.touches[0], e.touches[1]);\n      multiTouch = true;\n      startTouchListenerIfNeeded();\n    }\n  }\n\n  function beforeTouch(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeTouch`\n    if (options.onTouch && !options.onTouch(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/12\n      return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function beforeDoubleClick(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeDoubleClick``\n    if (options.onDoubleClick && !options.onDoubleClick(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/46\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function handleSingleFingerTouch(e) {\n    var touch = e.touches[0];\n    var offset = getOffsetXY(touch);\n    mouseX = offset.x;\n    mouseY = offset.y;\n\n    smoothScroll.cancel();\n    startTouchListenerIfNeeded();\n  }\n\n  function startTouchListenerIfNeeded() {\n    if (touchInProgress) {\n      // no need to do anything, as we already listen to events;\n      return;\n    }\n\n    touchInProgress = true;\n    document.addEventListener('touchmove', handleTouchMove);\n    document.addEventListener('touchend', handleTouchEnd);\n    document.addEventListener('touchcancel', handleTouchEnd);\n  }\n\n  function handleTouchMove(e) {\n    if (e.touches.length === 1) {\n      e.stopPropagation();\n      var touch = e.touches[0];\n\n      var offset = getOffsetXY(touch);\n      var point = transformToScreen(offset.x, offset.y);\n\n      var dx = point.x - mouseX;\n      var dy = point.y - mouseY;\n\n      if (dx !== 0 && dy !== 0) {\n        triggerPanStart();\n      }\n      mouseX = point.x;\n      mouseY = point.y;\n      internalMoveBy(dx, dy);\n    } else if (e.touches.length === 2) {\n      // it's a zoom, let's find direction\n      multiTouch = true;\n      var t1 = e.touches[0];\n      var t2 = e.touches[1];\n      var currentPinchLength = getPinchZoomLength(t1, t2);\n\n      // since the zoom speed is always based on distance from 1, we need to apply\n      // pinch speed only on that distance from 1:\n      var scaleMultiplier =\n        1 + (currentPinchLength / pinchZoomLength - 1) * pinchSpeed;\n\n      var firstTouchPoint = getOffsetXY(t1);\n      var secondTouchPoint = getOffsetXY(t2);\n      mouseX = (firstTouchPoint.x + secondTouchPoint.x) / 2;\n      mouseY = (firstTouchPoint.y + secondTouchPoint.y) / 2;\n      if (transformOrigin) {\n        var offset = getTransformOriginOffset();\n        mouseX = offset.x;\n        mouseY = offset.y;\n      }\n\n      publicZoomTo(mouseX, mouseY, scaleMultiplier);\n\n      pinchZoomLength = currentPinchLength;\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  function handleTouchEnd(e) {\n    if (e.touches.length > 0) {\n      var offset = getOffsetXY(e.touches[0]);\n      mouseX = offset.x;\n      mouseY = offset.y;\n    } else {\n      var now = new Date();\n      if (now - lastTouchEndTime < doubleTapSpeedInMS) {\n        if (transformOrigin) {\n          var offset = getTransformOriginOffset();\n          smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n        } else {\n          smoothZoom(mouseX, mouseY, zoomDoubleClickSpeed);\n        }\n      }\n\n      lastTouchEndTime = now;\n\n      touchInProgress = false;\n      triggerPanEnd();\n      releaseTouches();\n    }\n  }\n\n  function getPinchZoomLength(finger1, finger2) {\n    var dx = finger1.clientX - finger2.clientX;\n    var dy = finger1.clientY - finger2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  function onDoubleClick(e) {\n    beforeDoubleClick(e);\n    var offset = getOffsetXY(e);\n    if (transformOrigin) {\n      // TODO: looks like this is duplicated in the file.\n      // Need to refactor\n      offset = getTransformOriginOffset();\n    }\n    smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n  }\n\n  function onMouseDown(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeMouseDown(e)) return;\n\n    if (touchInProgress) {\n      // modern browsers will fire mousedown for touch events too\n      // we do not want this: touch is handled separately.\n      e.stopPropagation();\n      return false;\n    }\n    // for IE, left click == 1\n    // for Firefox, left click == 0\n    var isLeftButton =\n      (e.button === 1 && window.event !== null) || e.button === 0;\n    if (!isLeftButton) return;\n\n    smoothScroll.cancel();\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y;\n\n    // We need to listen on document itself, since mouse can go outside of the\n    // window, and we will loose it\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n    textSelection.capture(e.target || e.srcElement);\n\n    return false;\n  }\n\n  function onMouseMove(e) {\n    // no need to worry about mouse events when touch is happening\n    if (touchInProgress) return;\n\n    triggerPanStart();\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    var dx = point.x - mouseX;\n    var dy = point.y - mouseY;\n\n    mouseX = point.x;\n    mouseY = point.y;\n\n    internalMoveBy(dx, dy);\n  }\n\n  function onMouseUp() {\n    textSelection.release();\n    triggerPanEnd();\n    releaseDocumentMouse();\n  }\n\n  function releaseDocumentMouse() {\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n    panstartFired = false;\n  }\n\n  function releaseTouches() {\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n    document.removeEventListener('touchcancel', handleTouchEnd);\n    panstartFired = false;\n    multiTouch = false;\n  }\n\n  function onMouseWheel(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeWheel(e)) return;\n\n    smoothScroll.cancel();\n\n    var delta = e.deltaY;\n    if (e.deltaMode > 0) delta *= 100;\n\n    var scaleMultiplier = getScaleMultiplier(delta);\n\n    if (scaleMultiplier !== 1) {\n      var offset = transformOrigin\n        ? getTransformOriginOffset()\n        : getOffsetXY(e);\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n      e.preventDefault();\n    }\n  }\n\n  function getOffsetXY(e) {\n    var offsetX, offsetY;\n    // I tried using e.offsetX, but that gives wrong results for svg, when user clicks on a path.\n    var ownerRect = owner.getBoundingClientRect();\n    offsetX = e.clientX - ownerRect.left;\n    offsetY = e.clientY - ownerRect.top;\n\n    return { x: offsetX, y: offsetY };\n  }\n\n  function smoothZoom(clientX, clientY, scaleMultiplier) {\n    var fromValue = transform.scale;\n    var from = { scale: fromValue };\n    var to = { scale: scaleMultiplier * fromValue };\n\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      },\n      done: triggerZoomEnd\n    });\n  }\n\n  function smoothZoomAbs(clientX, clientY, toScaleValue) {\n    var fromValue = transform.scale;\n    var from = { scale: fromValue };\n    var to = { scale: toScaleValue };\n\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      }\n    });\n  }\n\n  function getTransformOriginOffset() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width * transformOrigin.x,\n      y: ownerRect.height * transformOrigin.y\n    };\n  }\n\n  function publicZoomTo(clientX, clientY, scaleMultiplier) {\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n    return zoomByRatio(clientX, clientY, scaleMultiplier);\n  }\n\n  function cancelZoomAnimation() {\n    if (zoomToAnimation) {\n      zoomToAnimation.cancel();\n      zoomToAnimation = null;\n    }\n  }\n\n  function getScaleMultiplier(delta) {\n    var sign = Math.sign(delta);\n    var deltaAdjustedSpeed = Math.min(0.25, Math.abs(speed * delta / 128));\n    return 1 - sign * deltaAdjustedSpeed;\n  }\n\n  function triggerPanStart() {\n    if (!panstartFired) {\n      triggerEvent('panstart');\n      panstartFired = true;\n      smoothScroll.start();\n    }\n  }\n\n  function triggerPanEnd() {\n    if (panstartFired) {\n      // we should never run smooth scrolling if it was multiTouch (pinch zoom animation):\n      if (!multiTouch) smoothScroll.stop();\n      triggerEvent('panend');\n    }\n  }\n\n  function triggerZoomEnd() {\n    triggerEvent('zoomend');\n  }\n\n  function triggerEvent(name) {\n    api.fire(name, api);\n  }\n}\n\nfunction parseTransformOrigin(options) {\n  if (!options) return;\n  if (typeof options === 'object') {\n    if (!isNumber(options.x) || !isNumber(options.y))\n      failTransformOrigin(options);\n    return options;\n  }\n\n  failTransformOrigin();\n}\n\nfunction failTransformOrigin(options) {\n  console.error(options);\n  throw new Error(\n    [\n      'Cannot parse transform origin.',\n      'Some good examples:',\n      '  \"center center\" can be achieved with {x: 0.5, y: 0.5}',\n      '  \"top center\" can be achieved with {x: 0.5, y: 0}',\n      '  \"bottom right\" can be achieved with {x: 1, y: 1}'\n    ].join('\\n')\n  );\n}\n\nfunction noop() { }\n\nfunction validateBounds(bounds) {\n  var boundsType = typeof bounds;\n  if (boundsType === 'undefined' || boundsType === 'boolean') return; // this is okay\n  // otherwise need to be more thorough:\n  var validBounds =\n    isNumber(bounds.left) &&\n    isNumber(bounds.top) &&\n    isNumber(bounds.bottom) &&\n    isNumber(bounds.right);\n\n  if (!validBounds)\n    throw new Error(\n      'Bounds object is not valid. It can be: ' +\n      'undefined, boolean (true|false) or an object {left, top, right, bottom}'\n    );\n}\n\nfunction isNumber(x) {\n  return Number.isFinite(x);\n}\n\n// IE 11 does not support isNaN:\nfunction isNaN(value) {\n  if (Number.isNaN) {\n    return Number.isNaN(value);\n  }\n\n  return value !== value;\n}\n\nfunction rigidScroll() {\n  return {\n    start: noop,\n    stop: noop,\n    cancel: noop\n  };\n}\n\nfunction autoRun() {\n  if (typeof document === 'undefined') return;\n\n  var scripts = document.getElementsByTagName('script');\n  if (!scripts) return;\n  var panzoomScript;\n\n  for (var i = 0; i < scripts.length; ++i) {\n    var x = scripts[i];\n    if (x.src && x.src.match(/\\bpanzoom(\\.min)?\\.js/)) {\n      panzoomScript = x;\n      break;\n    }\n  }\n\n  if (!panzoomScript) return;\n\n  var query = panzoomScript.getAttribute('query');\n  if (!query) return;\n\n  var globalName = panzoomScript.getAttribute('name') || 'pz';\n  var started = Date.now();\n\n  tryAttach();\n\n  function tryAttach() {\n    var el = document.querySelector(query);\n    if (!el) {\n      var now = Date.now();\n      var elapsed = now - started;\n      if (elapsed < 2000) {\n        // Let's wait a bit\n        setTimeout(tryAttach, 100);\n        return;\n      }\n      // If we don't attach within 2 seconds to the target element, consider it a failure\n      console.error('Cannot find the panzoom element', globalName);\n      return;\n    }\n    var options = collectOptions(panzoomScript);\n    console.log(options);\n    window[globalName] = createPanZoom(el, options);\n  }\n\n  function collectOptions(script) {\n    var attrs = script.attributes;\n    var options = {};\n    for (var i = 0; i < attrs.length; ++i) {\n      var attr = attrs[i];\n      var nameValue = getPanzoomAttributeNameValue(attr);\n      if (nameValue) {\n        options[nameValue.name] = nameValue.value;\n      }\n    }\n\n    return options;\n  }\n\n  function getPanzoomAttributeNameValue(attr) {\n    if (!attr.name) return;\n    var isPanZoomAttribute =\n      attr.name[0] === 'p' && attr.name[1] === 'z' && attr.name[2] === '-';\n\n    if (!isPanZoomAttribute) return;\n\n    var name = attr.name.substr(3);\n    var value = JSON.parse(attr.value);\n    return { name: name, value: value };\n  }\n}\n\nautoRun();\n","import makePanzoom from 'panzoom';\nimport {mat4} from 'gl-matrix';\n\nexport default function createMapCamera(scene, drawContext) {\n  var wglController = wglPanZoom(scene, drawContext);\n  let canvas = drawContext.canvas;\n  canvas.style.outline = 'none';\n  canvas.setAttribute('tabindex', 0);\n\n  \n  const api = ({\n    dispose,\n    setViewBox,\n    getPanzoom() { return panzoom; },\n    setSpeed(speed) {\n      panzoom.setZoomSpeed(speed);\n    }\n  });\n\n  const panzoom = makePanzoom(canvas, {\n    controller: wglController\n  }, api);\n\n  return api;\n\n  function dispose() {\n    panzoom.dispose()\n  }\n\n  function setViewBox(rect) {\n    const dx = (rect.left + rect.right)/2;\n    const dy = (rect.top + rect.bottom)/2;\n    const dpr = scene.getPixelRatio();\n    const nearHeight = dpr * Math.max((rect.top - rect.bottom)/2, (rect.right - rect.left) / 2);\n    let zScale = drawContext.height / ( 2 * nearHeight * dpr);\n\n    // TODO: Probably best to open the API on panzoom end.\n    let t = panzoom.getTransform();\n    t.scale = Math.tan(drawContext.fov / 2) / nearHeight;\n    t.x = -dx * zScale;\n    t.y = dy * zScale;\n    wglController.applyTransform(t);\n  }\n}\n\nfunction wglPanZoom(scene, drawContext) {\n    var z = 1;\n    var fov = drawContext.fov;\n    var controller = {\n      applyTransform(newT) {\n        z = 1 / newT.scale;\n        let zScale = 2 * Math.tan( fov / 2 ) * z\n        zScale = drawContext.height / ( zScale * scene.getPixelRatio());\n\n        let dx = -newT.x / zScale;\n        let dy = newT.y / zScale;\n\n\n        drawContext.origin[0] = dx;\n        drawContext.origin[1] = dy;\n        drawContext.origin[2] = z;\n        drawContext.center[0] = dx;\n        drawContext.center[1] = dy;\n        drawContext.center[2] = 0;\n\n        scene.fire('transform', drawContext);\n        mat4.lookAt(drawContext.view, drawContext.origin, drawContext.center, [0, 1, 0]);\n        scene.renderFrame()\n      },\n\n      getOwner() {\n        return drawContext.canvas\n      },\n\n      getScreenCTM() {\n        const dpr = 1/scene.getPixelRatio();\n        return {\n          a: 1,\n          d: 1,\n          e: dpr * drawContext.width / 2,\n          f: dpr * drawContext.height / 2\n        }\n      }\n    }\n\n    return controller;\n  }","const glUtils = {\n  compile,\n  link,\n  getLocations,\n  getAttributes,\n  getUniforms,\n  initBuffer\n};\n\nexport default glUtils;\n\nfunction compile(gl, type, shaderSrc) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, shaderSrc);\n  gl.compileShader(shader);\n\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\nfunction link(gl, vertexShader, fragmentShader) {\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  return program;\n}\n\nfunction getLocations(gl, program) {\n  return {\n    attributes: getAttributes(gl, program),\n    uniforms: getUniforms(gl, program)\n  }\n}\n\nfunction getAttributes(gl, program) {\n  var attributes = Object.create(null);\n\n  var numberOfAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  for (var i = 0; i < numberOfAttributes; ++i) {\n    var name = gl.getActiveAttrib(program, i).name;\n    attributes[name] = gl.getAttribLocation(program, name)\n  }\n\n  return attributes;\n}\n\nfunction getUniforms(gl, program) {\n  var uniforms = Object.create(null);\n  var numberOfUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (var i = 0; i < numberOfUniforms; ++i) {\n    var name = gl.getActiveUniform(program, i).name;\n    uniforms[name] = gl.getUniformLocation(program, name)\n  }\n\n  return uniforms;\n}\n\nfunction initBuffer(gl, data, elementsPerVertex, attribute) {\n  var buffer = gl.createBuffer();\n  if (!buffer) throw new Error('Failed to create a buffer');\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(attribute, elementsPerVertex, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(attribute);\n}","export default {\n  /**\n   * Gets vertex shader code from a given array of shader graph nodes.\n   */\n  getVSCode: getVSCode\n};\n\nfunction getVSCode(nodes) {\n  // We just generate shader code in multiple passes.\n  let code = [] \n  nodes.forEach(node => {\n    if (node.globals) code.push(node.globals());\n  });\n  code.push('void main() {')\n  nodes.forEach(node => {\n    if (node.mainBody) code.push(node.mainBody());\n  });\n  code.push('}')\n\n  return code.join('\\n');\n}\n","class Color {\n  constructor(r, g, b, a) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a === undefined ? 1 : a\n  }\n}\n\nexport default Color;","export default {\n  globals() {\n    return `\nattribute vec3 aPosition;\nuniform mat4 uCamera;\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform vec3 uOrigin;\n`;\n  },\n  mainBody() {\n    return `\n  // Translate screen coordinates to webgl space\n  mat4 modelView = uView * uModel;\n  vec4 mvPosition = modelView * vec4( aPosition, 1.0 );\n\n  vec4 glPos = uCamera * mvPosition;\n  gl_Position = glPos;\n`\n  }\n}","import gl_utils from '../glUtils';\n\nexport default makeLineProgram;\n\nimport shaderGraph from '../shaderGraph/index.js';\nimport panzoomVS from '../shaderGraph/panzoom.js';\n\nconst lineVSSrc = shaderGraph.getVSCode([\n  panzoomVS\n]);\n\nconst lineFSSrc = `\nprecision highp float;\nuniform vec4 uColor;\n\nvoid main() {\n  gl_FragColor = uColor;\n}\n`;\n\n// TODO: this needs to be in a separate file, with proper resource management\nlet lineProgramCache = new Map(); // maps from GL context to program\n\nfunction makeLineProgram(gl, data, drawTriangles, is3D) {\n  let lineProgram = lineProgramCache.get(gl)\n  if (!lineProgram) {\n    var lineVSShader = gl_utils.compile(gl, gl.VERTEX_SHADER, lineVSSrc);\n    var lineFSShader = gl_utils.compile(gl, gl.FRAGMENT_SHADER, lineFSSrc);\n    lineProgram = gl_utils.link(gl, lineVSShader, lineFSShader);\n    lineProgramCache.set(gl, lineProgram);\n  }\n\n  var locations = gl_utils.getLocations(gl, lineProgram);\n\n  var lineBuffer = gl.createBuffer();\n  var bpe = data.BYTES_PER_ELEMENT;\n  var drawType = drawTriangles ? gl.TRIANGLES : gl.LINES;\n  gl.bindBuffer(gl.ARRAY_BUFFER, lineBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, data.byteLength, gl.STATIC_DRAW);\n  gl.bufferSubData(gl.ARRAY_BUFFER, 0, data);\n\n  var api = {\n    draw,\n    dispose\n  }\n\n  return api;\n\n  function dispose() {\n    gl.deleteBuffer(lineBuffer);\n    gl.deleteProgram(lineProgram);\n    lineProgramCache.delete(gl);\n  }\n\n  function draw(lineCollection, drawContext) {\n    if (data.length === 0) return;\n    var size = is3D ? 3 : 2;\n\n    gl.useProgram(lineProgram);\n\n    gl.uniformMatrix4fv(locations.uniforms.uModel, false, lineCollection.worldModel);\n    gl.uniformMatrix4fv(locations.uniforms.uCamera, false, drawContext.camera);\n    gl.uniformMatrix4fv(locations.uniforms.uView, false, drawContext.view);\n    gl.uniform3fv(locations.uniforms.uOrigin, drawContext.origin);\n\n    var color = lineCollection.color;\n    gl.uniform4f(locations.uniforms.uColor, color.r, color.g, color.b, color.a);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, lineBuffer);\n    gl.enableVertexAttribArray(locations.attributes.aPosition)\n    // TODO: Avoid buffering, if data hasn't changed?\n    gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n    gl.vertexAttribPointer(locations.attributes.aPosition, size, gl.FLOAT, false, bpe * size, 0)\n\n    gl.drawArrays(drawType, 0, data.length / size);\n  }\n}\n","import gl_utils from '../glUtils';\nimport shaderGraph from '../shaderGraph/index.js';\nimport createMultiKeyCache from './createMultiKeyCache';\n\nlet lineProgramCache = createMultiKeyCache();\n\nexport default function makeWireProgram(gl, wireCollection) {\n  let allowColors = !!wireCollection.allowColors;\n  let programKey = [allowColors, gl];\n  let lineProgram = lineProgramCache.get(programKey)\n\n  if (!lineProgram) {\n    const { lineFSSrc, lineVSSrc } = getShadersCode(allowColors);\n    var lineVSShader = gl_utils.compile(gl, gl.VERTEX_SHADER, lineVSSrc);\n    var lineFSShader = gl_utils.compile(gl, gl.FRAGMENT_SHADER, lineFSSrc);\n    lineProgram = gl_utils.link(gl, lineVSShader, lineFSShader);\n    lineProgramCache.set(programKey, lineProgram);\n  }\n\n  let locations = gl_utils.getLocations(gl, lineProgram);\n\n  let lineBuffer = gl.createBuffer();\n  let lineSize = wireCollection.is3D ? 3 : 2;\n  let coloredLineStride = (lineSize + 1) * 4;\n  let colorOffset = lineSize * 4;\n\n  var api = {\n    draw,\n    dispose\n  }\n\n  return api;\n\n  function dispose() {\n    gl.deleteBuffer(lineBuffer);\n    gl.deleteProgram(lineProgram);\n    lineProgramCache.remove(programKey);\n  }\n\n  function draw(drawContext) {\n    if (wireCollection.count === 0) return;\n\n    let data = wireCollection.buffer;\n\n    gl.useProgram(lineProgram);\n\n    gl.uniformMatrix4fv(locations.uniforms.uModel, false, wireCollection.worldModel);\n    gl.uniformMatrix4fv(locations.uniforms.uCamera, false, drawContext.camera);\n    gl.uniformMatrix4fv(locations.uniforms.uView, false, drawContext.view);\n    gl.uniform3fv(locations.uniforms.uOrigin, drawContext.origin);\n\n    var color = wireCollection.color;\n    gl.uniform4f(locations.uniforms.uColor, color.r, color.g, color.b, color.a);\n\n    // TODO: Avoid buffering, if data hasn't changed?\n    gl.bindBuffer(gl.ARRAY_BUFFER, lineBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n\n    gl.enableVertexAttribArray(locations.attributes.aPosition)\n    if (allowColors) {\n      gl.vertexAttribPointer(\n        locations.attributes.aPosition,\n        lineSize,\n        gl.FLOAT,\n        false,\n        coloredLineStride,\n        0\n      );\n\n      gl.enableVertexAttribArray(locations.attributes.aColor);\n      gl.vertexAttribPointer(\n        locations.attributes.aColor,\n        4,\n        gl.UNSIGNED_BYTE,\n        true,\n        coloredLineStride,\n        colorOffset\n      );\n    } else {\n      gl.vertexAttribPointer(locations.attributes.aPosition, lineSize, gl.FLOAT, false, 4 * lineSize, 0)\n    }\n\n    gl.drawArrays(gl.LINES, 0, wireCollection.count * 2);\n  }\n}\n\nfunction getShadersCode(allowColors) {\n  const lineFSSrc = `precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vColor;\n}\n`;\n  const lineVSSrc = shaderGraph.getVSCode([\n    {\n      globals() {\n        return `\n  attribute vec3 aPosition;\n  varying vec4 vColor;\n  ${allowColors ? 'attribute vec4 aColor;' : ''}\n  uniform vec4 uColor;\n  uniform mat4 uCamera;\n  uniform mat4 uModel;\n  uniform mat4 uView;\n`;\n      },\n      mainBody() {\n        return `\n  gl_Position = uCamera * uView * uModel * vec4(aPosition, 1.0);\n  vColor = ${allowColors ? 'aColor.abgr' : 'uColor'};\n`;\n      }\n    }\n  ]);\n  return { lineVSSrc, lineFSSrc };\n}","/**\n * Naive implementation of a multi-key cache.\n */\nexport default function createMultiKeyCache() {\n  let cache = new Map();\n  return {\n    get,\n    set,\n    remove\n  };\n\n  function get(keys) {\n    if (!keys) return;\n    let lastCache = cache;\n    let entry;\n    for (let i = 0; i < keys.length; ++i) {\n      let key = keys[i];\n      entry = lastCache.get(key);\n      if (!entry) return;\n      lastCache = entry;\n    }\n    return entry;\n  }\n\n  function set(keys, value) {\n    let lastCache = cache;\n    for (let i = 0; i < keys.length - 1; ++i) {\n      let key = keys[i];\n      let entry = lastCache.get(key);\n      if (!entry) {\n        entry = new Map();\n        lastCache.set(key, entry);\n      }\n      lastCache = entry;\n    }\n    lastCache.set(keys[keys.length - 1], value);\n  }\n\n  function remove(keys) {\n    let lastCache = cache;\n    for (let i = 0; i < keys.length - 1; ++i) {\n      let key = keys[i];\n      let entry = lastCache.get(key);\n      if (!entry) return;\n      lastCache = entry;\n    }\n    lastCache.delete(keys[keys.length - 1]);\n    // TODO: Might also want to remove parent elements if this was the last entity.\n  }\n}\n","/**\n * Wire accessor provides access to the buffer that stores wires.\n * \n * Wires are \"lines\" with 1.0 width.\n */\nclass WireAccessor {\n  constructor(wireCollection, offset) {\n    this.offset = offset;\n    this._wire = wireCollection;\n    this.update = wireCollection.is3D ? this.update3D : this.update2D;\n  }\n\n  update2D(from, to) {\n    var positions = this._wire.positions;\n    var offset = this.offset;\n\n    positions[offset + 0] = from.x;\n    positions[offset + 1] = from.y;\n    offset += 2;\n    var hasColor = this._wire.allowColors;\n    if (hasColor) {\n      if (from.color !== undefined) this._wire.colors[offset] = from.color;\n      offset += 1;\n    }\n\n    positions[offset + 0] = to.x\n    positions[offset + 1] = to.y\n    if (hasColor && to.color) {\n      this._wire.colors[offset + 2] = to.color;\n    }\n  }\n\n  update3D(from, to) {\n    var positions = this._wire.positions;\n    var offset = this.offset;\n\n    positions[offset + 0] = from.x\n    positions[offset + 1] = from.y\n    positions[offset + 2] = from.z || 0\n    offset += 3;\n    var hasColor = this._wire.allowColors;\n    if (hasColor) {\n      if (from.color !== undefined) this._wire.colors[offset] = from.color;\n      offset += 1;\n    }\n\n    positions[offset + 0] = to.x\n    positions[offset + 1] = to.y\n    positions[offset + 2] = to.z || 0\n    if (hasColor && to.color) this._wire.colors[offset + 3] = to.color;\n  }\n}\n\nexport default WireAccessor;","import {createScene, WireCollection} from 'w-gl';\n\nlet scene = createScene(document.querySelector('canvas'));\n\n// let's draw a grid:\nlet lines = new WireCollection(22);\nfor (let row = 0; row <= 10; ++row) {\n  lines.add({\n    from: {x: 0, y: row},\n    to: {x: 10, y: row}\n  });\n}\nfor (let col = 0; col <= 10; ++col) {\n  lines.add({\n    from: {x: col, y: 0},\n    to: {x: col, y: 10}\n  });\n}\nscene.appendChild(lines);\n\n// and lets bring it into the view:\nscene.setViewBox({\n  left: -2,\n  top: 12,\n  right: 12,\n  bottom: 2 \n})\n","import eventify from 'ngraph.events';\n\nimport Element from './Element';\nimport onClap from './clap';\nimport {mat4, vec4} from 'gl-matrix';\nimport createMapCamera from './createMapCamera';\n\nexport default function createScene(canvas, options) {\n  var width;\n  var height;\n  if (!options) options = {};\n\n  var pixelRatio = options.devicePixelRatio || window.devicePixelRatio;\n  var wglContextOptions = options.wglContext;\n\n  var gl = canvas.getContext('webgl', wglContextOptions) || canvas.getContext('experimental-webgl', wglContextOptions);\n\n  gl.enable(gl.BLEND);\n  gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n  gl.clearColor(0, 0, 0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT)\n\n  var frameToken = 0;\n  var sceneRoot = new Element();\n\n  var view = mat4.create();\n  var camera = mat4.create();\n  var fov = options.fov === undefined ? Math.PI / 6 : options.fov;\n  var near = options.near === undefined ? 1e-2 : options.near;\n  var far = options.far === undefined ? Infinity : options.far;\n\n  var drawContext = { \n    width: window.innerWidth,\n    height: window.innerHeight,\n    canvas,\n    camera,\n    view,\n    fov,\n    center: [0, 0, 0],\n    origin: new Float32Array(3)\n };\n\n  updateCanvasSize();\n\n  var api = eventify({\n    appendChild,\n    getSceneCoordinate,\n    getClientCoordinate,\n    getTransform,\n    getRoot,\n    getGL,\n    removeChild,\n    setViewBox,\n    setClearColor,\n    getClearColor,\n    clear,\n    dispose,\n    renderFrame,\n\n    getPixelRatio,\n    setPixelRatio,\n\n    getCamera,\n    setCamera,\n    getDrawContext\n  });\n\n\n  sceneRoot.bindScene(api);\n  let cameraController = (options.camera || createMapCamera)(api, drawContext);\n\n  var disposeClick;\n  listenToEvents();\n\n  renderFrame();\n\n  return api;\n\n  function getPixelRatio() {\n    return pixelRatio;\n  }\n\n  function getDrawContext() {\n    return drawContext;\n  }\n\n  function setPixelRatio(newPixelRatio) {\n    pixelRatio = newPixelRatio;\n    updateCanvasSize();\n  }\n\n  function getGL() {\n    return gl;\n  }\n\n  function getRoot() {\n    return sceneRoot;\n  }\n\n  function setCamera(createCamera) {\n    if (cameraController) {\n      cameraController.dispose();\n    }\n    cameraController = createCamera(api, drawContext);\n  }\n\n  function getCamera() {\n    return cameraController;\n  }\n\n  function getTransform() {\n    return sceneRoot.model;\n  }\n\n  function setClearColor(r, g, b, a) {\n    gl.clearColor(r, g, b, a)\n  }\n\n  function getClearColor() {\n    // [r, g, b, a]\n    return gl.getParameter(gl.COLOR_CLEAR_VALUE);\n  }\n\n  function listenToEvents() {\n    canvas.addEventListener('mousemove', onMouseMove);\n\n    disposeClick = onClap(canvas, onMouseClick, this);\n\n    window.addEventListener('resize', onResize, true);\n  }\n\n  function dispose() {\n    canvas.removeEventListener('mousemove', onMouseMove);\n\n\n    if (disposeClick) disposeClick();\n\n    window.removeEventListener('resize', onResize, true);\n\n    cameraController.dispose();\n    sceneRoot.dispose();\n\n    if (frameToken) {\n      cancelAnimationFrame(frameToken);\n      frameToken = 0;\n    }\n  }\n\n  function onResize() {\n    updateCanvasSize();\n  }\n\n  function updateCanvasSize() {\n    if (options.size) {\n      // Fixed size canvas doesn't update. We assume CSS does the scaling.\n      width = canvas.width = options.size.width;\n      height = canvas.height = options.size.height;\n    } else {\n      width = canvas.width = canvas.offsetWidth * pixelRatio;\n      height = canvas.height = canvas.offsetHeight * pixelRatio;\n    }\n\n    gl.viewport(0, 0, width, height);\n\n    drawContext.width = width;\n    drawContext.height = height;\n    sceneRoot.worldTransformNeedsUpdate = true;\n    mat4.perspective(camera, fov, width/height, near, far);\n    renderFrame();\n  }\n\n  function onMouseClick(e) {\n    var p = getSceneCoordinate(e.clientX, e.clientY);\n    if (!p) return; // need to zoom in!\n\n    api.fire('click', {\n      originalEvent: e,\n      sceneX: p.x,\n      sceneY: p.y,\n    })\n  }\n\n  function onMouseMove(e) {\n    var p = getSceneCoordinate(e.clientX, e.clientY);\n    if (!p) return;\n\n    api.fire('mousemove', {\n      originalEvent: e,\n      x: p.x,\n      y: p.y,\n      z: p.z,\n    });\n  }\n\n  function getSceneCoordinate(clientX, clientY) {\n    // TODO: This is not optimized by any means.\n    var dpr = api.getPixelRatio();\n    let clipSpaceX = (dpr * clientX / width) * 2 - 1;\n    let clipSpaceY = (1 - dpr * clientY / height) * 2 - 1;\n\n    var mvp = mat4.multiply(mat4.create(), camera, view)\n    mat4.multiply(mvp, mvp, sceneRoot.model);\n    // TODO: This wouldn't work when camera is rotated.\n    var zero = vec4.transformMat4([], [drawContext.center[0], drawContext.center[1], drawContext.center[2], 1], mvp);\n    var iMvp = mat4.invert(mat4.create(), mvp);\n    if (!iMvp) {\n      // likely they zoomed out too far for this `near` plane.\n      return;\n    }\n    const sceneCoordinate =  vec4.transformMat4([], [zero[3] * clipSpaceX, zero[3] * clipSpaceY, zero[2], zero[3]], iMvp);\n    return {\n      x: sceneCoordinate[0]/sceneCoordinate[3],\n      y: sceneCoordinate[1]/sceneCoordinate[3],\n      z: sceneCoordinate[2]/sceneCoordinate[3],\n    }\n  }\n\n  function getClientCoordinate(sceneX, sceneY, sceneZ = 0) {\n    // TODO: this is not optimized either.\n    var mvp = mat4.multiply(mat4.create(), camera, view)\n    mat4.multiply(mvp, mvp, sceneRoot.model);\n    var coordinate = vec4.transformMat4([], [sceneX, sceneY, sceneZ, 1], mvp);\n\n    var dpr = api.getPixelRatio();\n    var x = width * (coordinate[0]/coordinate[3] + 1) * 0.5/dpr;\n    var y = height * (1 - (coordinate[1]/coordinate[3] + 1) * 0.5)/dpr;\n    return {x, y};\n  }\n\n  function setViewBox(rect) {\n    cameraController.setViewBox(rect);\n  }\n\n  function renderFrame(immediate) {\n    if (immediate) {\n      return frame();\n    }\n\n    if (!frameToken) frameToken = requestAnimationFrame(frame)\n  }\n\n  function frame() {\n    gl.clear(gl.COLOR_BUFFER_BIT)\n    drawContext.wasDirty = sceneRoot.updateWorldTransform();\n    sceneRoot.draw(gl, drawContext);\n    frameToken = 0;\n  }\n\n  function clear() {\n    gl.clear(gl.COLOR_BUFFER_BIT)\n  }\n\n  function appendChild(child, sendToBack) {\n    sceneRoot.appendChild(child, sendToBack);\n  }\n\n  function removeChild(child) {\n    sceneRoot.removeChild(child)\n  }\n}\n","import Element from '../Element';\nimport makeWireProgram from './makeWireProgram';\nimport WireAccessor from './WireAccessor';\nimport Color from '../Color';\n\n/**\n * Unlike lines, wires do not have width, and are always 1px wide, regardless\n * of resolution.\n */\nclass WireCollection extends Element {\n  constructor(capacity, options) {\n    super();\n    let bytesPerElement = 4; // float32 or uint32 - both require 4 bytes\n    this.is3D = options && options.is3D;\n    this.allowColors = options && options.allowColors;\n    this.itemsPerLine = 4; // (startX, startY) (endX, endY);\n    if (this.is3D) this.itemsPerLine += 2; // Add two more for Z;\n    if (this.allowColors) this.itemsPerLine += 2; // Add two more for color\n\n    this.capacity = capacity;\n    this.count = 0;\n    this.color = new Color(1, 1, 1, 1);\n    this.type = 'WireCollection';\n    this._program = null;\n    this.buffer = new ArrayBuffer(capacity * this.itemsPerLine * bytesPerElement)\n    this.positions = new Float32Array(this.buffer);\n\n    if (this.allowColors) {\n      // We are sharing the buffer!\n      this.colors = new Uint32Array(this.buffer);\n    }\n  }\n\n  draw(gl, drawContext) {\n    if (!this._program) {\n      this._program = makeWireProgram(gl, this);\n    }\n    this._program.draw(drawContext);\n  }\n\n  add(line) {\n    if (!line) throw new Error('Line is required');\n\n    if (this.count >= this.capacity)  {\n      this._extendArray();\n    }\n\n    var offset = this.count * this.itemsPerLine;\n    let ui = new WireAccessor(this, offset);\n    ui.update(line.from, line.to)\n\n    this.count += 1;\n    return ui;\n  }\n\n  forEachLine(callback) {\n    const {positions, count, itemsPerLine, allowColors} = this;\n    let maxOffset = count * itemsPerLine;\n\n    if (this.is3D) {\n      for (let i = 0; i < maxOffset; i += itemsPerLine) {\n        let from = {\n          x: positions[i],\n          y: positions[i + 1],\n          z: positions[i + 2]\n        }\n        let next = i + 3;\n        if (allowColors) {\n          from.color = this.colors[i + 3];\n          next += 1;\n        }\n        let to = {\n          x: positions[next],\n          y: positions[next + 1],\n          z: positions[next + 2]\n        };\n        if (allowColors) {\n          to.color = this.colors[next + 3];\n        }\n        callback(from, to);\n      }\n    } else {\n      for (let i = 0; i < maxOffset; i += itemsPerLine) {\n        let from = {\n          x: positions[i],\n          y: positions[i + 1],\n          z: 0,\n        }\n        let next = i + 2;\n        if (allowColors) {\n          from.color = this.colors[i + 2];\n          next += 1;\n        }\n        let to = {\n          x: positions[next],\n          y: positions[next + 1],\n          z: 0,\n        };\n        if (allowColors) {\n          to.color = this.colors[next + 2];\n        }\n        callback(from, to);\n      }\n    }\n  }\n\n  dispose() {\n    if (this._program) {\n      this._program.dispose();\n      this._program = null;\n    }\n  }\n\n  _extendArray() {\n    // Every time we run out of space create new array twice bigger.\n    var buffer = new ArrayBuffer(this.buffer.byteLength * 2);\n    var extendedArray = new Float32Array(buffer);\n    if (this.positions) {\n      extendedArray.set(this.positions);\n    }\n\n    this.buffer = buffer;\n    this.positions = extendedArray;\n    if (this.allowColors) {\n      this.colors = new Uint32Array(buffer);\n    }\n    this.capacity *= 2;\n  }\n}\n\nexport default WireCollection;"],"names":["subject","Error","reservedWords","i","length","hasOwnProperty","validateSubject","eventsStorage","registeredEvents","Object","create","on","eventName","callback","ctx","handlers","push","off","callbacks","splice","fire","fireArguments","arguments","Array","prototype","call","callbackInfo","apply","createEventsStorage","ARRAY_TYPE","Float32Array","out","glMatrix.ARRAY_TYPE","multiply","a","b","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","transformMat4","m","x","y","z","w","Math","hypot","sqrt","vec","Element","[object Object]","this","children","model","mat4.create","worldModel","worldTransformNeedsUpdate","type","scene","child","sendToBack","parent","unshift","bindScene","renderFrame","enterCallback","exitCallback","traverse","rad","axis","s","c","t","b00","b01","b02","b10","b11","b12","b20","b21","b22","len","sin","cos","mat4.rotate","mat4.rotateX","mat4.rotateY","mat4.rotateZ","v","mat4.scale","mat4.translate","childIdx","indexOf","force","mat4.multiply","mat4.copy","wasDirty","updateWorldTransform","gl","screen","draw","dispose","config","addWheelListener","element","listener","useCapture","removeEventListener","addEventListener","float32ArraySupported","A","aA1","aA2","B","C","calcBezier","aT","getSlope","LinearEasing","mX1","mY1","mX2","mY2","sampleValues","getTForX","aX","intervalStart","currentSample","kSplineTableSize","guessForT","initialSlope","aGuessT","currentSlope","newtonRaphsonIterate","aA","aB","currentX","currentT","abs","binarySubdivide","animations","ease","BezierEasing","easeIn","easeOut","easeInOut","linear","source","target","options","start","diff","easing","console","warn","step","noop","done","scheduler","window","requestAnimationFrame","next","bind","cancel","cancelAnimationFrame","cb","setTimeout","id","clearTimeout","getScheduler","keys","forEach","key","previousAnimationId","durationInMs","duration","durationInFrames","max","frame","loop","setValues","makeAggregateRaf","frontBuffer","Set","backBuffer","frameToken","clearAll","clear","add","getPoint","scroll","settings","lastPoint","timestamp","ticker","vx","targetX","ax","vy","targetY","ay","raf","minVelocity","amplitude","global","handler","Date","track","stop","currentPoint","now","autoScroll","elapsed","dx","dy","dt","moving","exp","useFake","capture","release","dragObject","prevSelectStart","prevDragStart","wasCaptured","domObject","document","onselectstart","ondragstart","disabled","e","stopPropagation","scale","svgElement","SVGElement","owner","ownerSVGElement","disableKeyboardInteraction","setAttribute","getBBox","bbox","left","top","width","height","getScreenCTM","ctm","getCTM","getOwner","applyTransform","transform","initTransform","screenCTM","f","removeAttributeNS","domElement","HTMLElement","parentElement","scrollTop","clientWidth","clientHeight","style","transformOrigin","domTextSelectionInterceptor","createTextSelectionInterceptor","fakeTextSelectorInterceptor","createPanZoom","panController","controller","makeSvgController","makeDomController","storedCTMResult","isDirty","Transform","frameAnimation","filterKey","pinchSpeed","bounds","maxZoom","Number","POSITIVE_INFINITY","minZoom","boundsPadding","zoomDoubleClickSpeed","beforeWheel","beforeMouseDown","speed","zoomSpeed","parseTransformOrigin","textSelection","enableTextSelection","boundsType","isNumber","bottom","right","validateBounds","autocenter","h","sceneBoundingBox","getBoundingBox","ownerRect","getBoundingClientRect","dh","dw","min","mouseX","mouseY","pinchZoomLength","smoothScroll","moveByAnimation","zoomToAnimation","multiTouch","lastTouchEndTime","touchInProgress","panstartFired","kinetic","cancelZoomAnimation","moveTo","paused","listenForEvents","api","releaseEvents","moveBy","internalMoveBy","centerOn","ui","clientRect","cx","cy","container","zoomTo","publicZoomTo","zoomAbs","smoothZoom","smoothZoomAbs","clientX","clientY","toScaleValue","from","to","animate","showRectangle","rect","size","transformToScreen","rectWidth","rectHeight","isFinite","pause","resume","isPaused","getTransform","getMinZoom","setMinZoom","newMinZoom","getMaxZoom","setMaxZoom","newMaxZoom","getTransformOrigin","setTransformOrigin","newTransformOrigin","getZoomSpeed","setZoomSpeed","newSpeed","eventify","parentCTM","parentScaleX","parentScaleY","d","parentOffsetX","parentOffsetY","keepTransformInsideBounds","triggerEvent","makeDirty","boundingBox","leftTop","adjusted","sceneWidth","sceneHeight","zoomByRatio","ratio","isNaN","newScale","zoomLevel","smooth","lastX","lastY","onMouseDown","passive","onDoubleClick","onTouch","onKeyDown","wheel","onMouseWheel","removeWheelListener","releaseDocumentMouse","releaseTouches","triggerPanEnd","keyCode","preventDefault","offset","scaleMultiplier","getScaleMultiplier","getTransformOriginOffset","beforeTouch","touches","getOffsetXY","startTouchListenerIfNeeded","handleSingleFingerTouch","getPinchZoomLength","handleTouchMove","handleTouchEnd","point","triggerPanStart","t1","t2","currentPinchLength","firstTouchPoint","secondTouchPoint","finger1","finger2","beforeDoubleClick","button","event","onMouseMove","onMouseUp","srcElement","delta","deltaY","deltaMode","fromValue","triggerZoomEnd","sign","name","failTransformOrigin","error","join","value","createMapCamera","drawContext","wglController","fov","newT","zScale","tan","getPixelRatio","origin","center","eye","up","x0","x1","x2","y0","y1","y2","z0","z1","z2","eyex","eyey","eyez","upx","upy","upz","centerx","centery","centerz","identity","mat4.lookAt","view","canvas","dpr","wglPanZoom","outline","panzoom","setViewBox","nearHeight","getPanzoom","makePanzoom","scripts","getElementsByTagName","panzoomScript","src","match","query","getAttribute","globalName","started","tryAttach","el","querySelector","script","attrs","attributes","nameValue","getPanzoomAttributeNameValue","collectOptions","log","attr","substr","JSON","parse","autoRun","glUtils","compile","shaderSrc","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","link","vertexShader","fragmentShader","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","getLocations","getAttributes","uniforms","getUniforms","initBuffer","data","elementsPerVertex","attribute","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vertexAttribPointer","FLOAT","enableVertexAttribArray","numberOfAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","numberOfUniforms","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","getVSCode","nodes","code","node","globals","mainBody","Color","r","g","undefined","shaderGraph","panzoomVS","lineProgramCache","cache","Map","get","entry","lastCache","set","remove","delete","createMultiKeyCache","makeWireProgram","wireCollection","allowColors","programKey","lineProgram","lineFSSrc","lineVSSrc","getShadersCode","lineVSShader","gl_utils","VERTEX_SHADER","lineFSShader","FRAGMENT_SHADER","locations","lineBuffer","lineSize","is3D","coloredLineStride","colorOffset","count","useProgram","uniformMatrix4fv","uModel","uCamera","camera","uView","uniform3fv","uOrigin","color","uniform4f","uColor","aPosition","aColor","UNSIGNED_BYTE","drawArrays","LINES","deleteBuffer","deleteProgram","WireAccessor","_wire","update","update3D","update2D","positions","hasColor","colors","pixelRatio","devicePixelRatio","wglContextOptions","wglContext","getContext","enable","BLEND","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","clearColor","COLOR_BUFFER_BIT","sceneRoot","PI","near","far","Infinity","innerWidth","innerHeight","updateCanvasSize","appendChild","getSceneCoordinate","getClientCoordinate","sceneX","sceneY","sceneZ","mvp","coordinate","vec4.transformMat4","getRoot","getGL","removeChild","cameraController","setClearColor","getClearColor","getParameter","COLOR_CLEAR_VALUE","disposeClick","onResize","setPixelRatio","newPixelRatio","getCamera","setCamera","createCamera","getDrawContext","startPos","touchStartTime","invokeHandler","handleTouchStart","pageX","pageY","touch","changedTouches","onClap","onMouseClick","listenToEvents","offsetWidth","offsetHeight","viewport","fovy","aspect","nf","mat4.perspective","p","originalEvent","clipSpaceX","clipSpaceY","zero","iMvp","b03","b04","b05","b06","b07","b08","b09","det","mat4.invert","sceneCoordinate","immediate","createScene","lines","capacity","super","itemsPerLine","_program","ArrayBuffer","Uint32Array","line","_extendArray","maxOffset","byteLength","extendedArray","row","col"],"mappings":"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"}